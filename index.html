<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Enterprise Management Pro v2.3</title>
    <!-- Bibliothèques externes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="styles.css" rel="stylesheet">
    <!-- CSS déplacé vers styles.css -->
</head>
<body class="antialiased">

<!-- 1. L'écran de verrouillage (Placé au tout début du body) -->
<!-- Écran de Licence -->
    <div id="license-overlay" style="position: fixed; inset: 0; background: rgba(15, 23, 42, 0.98); z-index: 9999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px);">
        <div style="background: white; padding: 1.5rem; border-radius: 1.5rem; width: 95%; max-width: 400px; position: relative; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);">
            <!-- Bouton fermer (X) -->
            <button id="close-license" onclick="document.getElementById('license-overlay').style.display='none'" style="position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #94a3b8; cursor: pointer; border: none; background: none;" class="hidden">✕</button>
            
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.25rem; font-weight: bold; color: #111827;">Activation du logiciel</h2>
                <p id="license-msg" style="color: #6b7280; margin-top: 0.5rem; font-size: 0.875rem;">Enregistrez votre licence pour un accès illimité.</p>
            </div>

            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div>
                    <label style="font-size: 0.75rem; font-weight: 600; color: #9ca3af; text-transform: uppercase;">ID Matériel</label>
                    <input type="text" id="device-id-display" readonly style="width: 100%; margin-top: 0.5rem; padding: 0.75rem; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.5rem; font-family: monospace; font-size: 0.875rem;">
                </div>
                <div>
                    <label style="font-size: 0.75rem; font-weight: 600; color: #9ca3af; text-transform: uppercase;">Clé de licence</label>
                    <input type="text" id="license-key-input" placeholder="ENTREZ VOTRE CLÉ ICI" style="width: 100%; margin-top: 0.5rem; padding: 1rem; border: 2px solid #f3f4f6; border-radius: 0.75rem; text-align: center; font-weight: bold; outline: none; font-size: 1rem;">
                </div>
                <button onclick="validateAndActivate()" style="width: 100%; background: #2563eb; color: white; padding: 1rem; border-radius: 0.75rem; font-weight: bold; cursor: pointer; border: none; font-size: 1rem;">Activer maintenant</button>
            </div>
        </div>
    </div>

    <!-- Badge d'essai flottant -->
    <div id="trial-info-badge" class="trial-badge" onclick="document.getElementById('license-overlay').style.display='flex'">
        <span style="height: 10px; width: 10px; background: #3b82f6; border-radius: 50%; display: inline-block;"></span>
        <span id="days-text" style="font-size: 0.85rem; font-weight: 600; color: #475569;">Calcul...</span>
    </div>

    <!-- Écran de connexion Poste (Multiposte) -->
    <div id="poste-login-overlay" style="position: fixed; inset: 0; background: rgba(15, 23, 42, 0.96); z-index: 9998; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px);">
        <div class="glass-card p-6 md:p-8 rounded-2xl shadow-2xl w-full max-w-md mx-4">
            <h2 class="text-xl font-bold text-slate-800 mb-2 text-center">Connexion Poste</h2>
            <p class="text-slate-500 text-sm mb-6 text-center">Sélectionnez votre poste et entrez le mot de passe</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Poste</label>
                    <select id="poste-login-select" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Choisir un poste --</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Mot de passe</label>
                    <input type="password" id="poste-login-password" placeholder="Mot de passe" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="pt-2">
                    <button onclick="doPosteLogin()" class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700">Se connecter</button>
                </div>
                <div class="text-center space-y-2">
                    <button onclick="showAdminLoginModal()" class="w-full py-2.5 bg-purple-50 text-purple-700 rounded-xl font-medium hover:bg-purple-100 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="user-cog" class="w-4 h-4"></i>
                        Connexion administrateur
                    </button>
                </div>
            </div>
        </div>
    </div>

<!-- 2. Enveloppe de l'application (TRES IMPORTANT) -->
<!-- Vous devez entourer TOUT votre code original (Sidebar, Main, etc.) par cette balise -->
<div id="app-content" style="display: none;">
    <!-- TOUT VOTRE CODE ORIGINAL VA ICI -->


    <!-- APP WRAPPER -->
    <div class="flex min-h-screen overflow-hidden">

        <!-- DESKTOP SIDEBAR -->
        <aside class="desktop-sidebar w-64 glass-card border-r flex flex-col z-50">
            <div class="p-6">
                <div class="flex items-center gap-3 text-blue-600 font-bold text-xl">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <i data-lucide="layout-grid"></i>
                    </div>
                    <span id="sidebar-company-name">Enterprise <span class="text-slate-400 font-light">Pro</span></span>
                </div>
            </div>

            <nav class="flex-1 px-4 space-y-2 py-4 overflow-y-auto">
                <button onclick="switchTab('dashboard')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 transition-all active" id="btn-dashboard">
                    <i data-lucide="home" class="w-5 h-5"></i> Dashboard
                </button>
                <button onclick="switchTab('stock')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" id="btn-stock">
                    <i data-lucide="package" class="w-5 h-5"></i> Matériel & Stock
                </button>
                <button onclick="switchTab('sales')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" id="btn-sales">
                    <i data-lucide="shopping-cart" class="w-5 h-5"></i> Ventes & Facturation
                </button>
                <button onclick="switchTab('credits')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" id="btn-credits">
                    <i data-lucide="credit-card" class="w-5 h-5"></i> Crédits Clients
                </button>
                <button onclick="switchTab('expenses')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" id="btn-expenses">
                    <i data-lucide="receipt" class="w-5 h-5"></i> Dépenses / Caisse
                </button>
                <button onclick="switchTab('logs')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" id="btn-logs">
                    <i data-lucide="history" class="w-5 h-5"></i> Logs Système
                </button>
                <button onclick="switchTab('reports')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" id="btn-reports">
                    <i data-lucide="file-text" class="w-5 h-5"></i> Rapports
                </button>
            </nav>

            <div class="p-4 border-t space-y-2">
                <button onclick="switchTab('settings')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" id="btn-settings">
                    <i data-lucide="settings" class="w-5 h-5"></i> Paramètres
                </button>
                <div class="text-[10px] text-slate-400 text-center mt-2">v1.0.0 Goaka Edition</div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col min-w-0 bg-slate-50 relative h-screen overflow-hidden">
            
            <!-- HEADER - IMPROVED FOR MOBILE -->
            <header class="h-16 glass-card border-b px-4 md:px-6 flex items-center justify-between z-40">
                <div class="flex items-center gap-3">
                    <!-- Mobile menu button -->
                    <button id="mobile-menu-btn" class="mobile-only p-2 text-slate-600 hover:bg-slate-100 rounded-lg">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                    <h2 id="current-tab-title" class="text-lg font-semibold text-slate-800 truncate max-w-[150px] md:max-w-none">Tableau de bord</h2>
                    <span id="header-alert" class="hidden text-xs px-2 py-1 rounded-full bg-red-100 text-red-600 font-semibold"></span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="hidden md:flex flex-col items-end">
                        <span id="header-date" class="text-xs text-slate-500 font-medium">--/--/----</span>
                        <span id="header-caisse" class="text-sm font-bold text-blue-600">0 Ar</span>
                    </div>
                    <!-- Mobile caisse display -->
                    <div class="mobile-only flex flex-col items-end">
                        <span id="header-caisse-mobile" class="text-sm font-bold text-blue-600">0 Ar</span>
                        <span class="text-[10px] text-slate-500">Caisse</span>
                    </div>
                    <button onclick="refreshData()" class="p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors touch-target">
                        <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                    </button>
                    <button id="btn-changer-poste" onclick="logoutPoste(); location.reload();" class="hidden p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors touch-target" title="Changer de poste">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                    </button>
                </div>
            </header>

            <!-- MOBILE SIDEBAR MENU -->
            <div id="mobile-sidebar" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[60] hidden md:hidden">
                <div class="absolute right-0 top-0 bottom-0 w-64 bg-white shadow-xl">
                    <div class="p-6 border-b">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3 text-blue-600 font-bold text-xl">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <i data-lucide="layout-grid"></i>
                                </div>
                                <span id="mobile-sidebar-company-name">Enterprise Pro</span>
                            </div>
                            <button onclick="closeMobileMenu()" class="p-2 hover:bg-slate-100 rounded-full">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                    <nav class="p-4 space-y-2" id="mobile-sidebar-nav">
                        <button onclick="switchTab('dashboard'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 transition-all" data-tab="dashboard">
                            <i data-lucide="home" class="w-5 h-5"></i> Dashboard
                        </button>
                        <button onclick="switchTab('stock'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" data-tab="stock">
                            <i data-lucide="package" class="w-5 h-5"></i> Matériel & Stock
                        </button>
                        <button onclick="switchTab('sales'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" data-tab="sales">
                            <i data-lucide="shopping-cart" class="w-5 h-5"></i> Ventes & Facturation
                        </button>
                        <button onclick="switchTab('credits'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" data-tab="credits">
                            <i data-lucide="credit-card" class="w-5 h-5"></i> Crédits Clients
                        </button>
                        <button onclick="switchTab('expenses'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" data-tab="expenses">
                            <i data-lucide="receipt" class="w-5 h-5"></i> Dépenses / Caisse
                        </button>
                        <button onclick="switchTab('logs'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" data-tab="logs">
                            <i data-lucide="history" class="w-5 h-5"></i> Logs Système
                        </button>
                        <button onclick="switchTab('reports'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50" data-tab="reports">
                            <i data-lucide="file-text" class="w-5 h-5"></i> Rapports
                        </button>
                        <button onclick="switchTab('settings'); closeMobileMenu();" class="mobile-sidebar-link sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 mt-8" data-tab="settings">
                            <i data-lucide="settings" class="w-5 h-5"></i> Paramètres
                        </button>
                    </nav>
                </div>
            </div>

            <!-- CONTENT SCROLL AREA -->
            <div id="scroll-area" class="flex-1 overflow-y-auto p-4 md:p-8 main-content">
                
                <!-- DASHBOARD TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-dashboard" class="tab-content active space-y-4 md:space-y-6">
                    <div class="flex items-center justify-end gap-3">
                        <select id="dashboard-period" onchange="onDashboardPeriodChange()" class="text-xs md:text-sm border rounded-lg px-3 py-2 md:py-1 outline-none w-full md:w-auto">
                            <option value="today">Aujourd'hui</option>
                            <option value="week">7 derniers jours</option>
                            <option value="month">30 derniers jours</option>
                            <option value="year">Cette année</option>
                            <option value="all" selected>Tous</option>
                            <option value="custom">Date précise</option>
                        </select>
                        <input id="dashboard-date" type="date" class="text-xs md:text-sm border rounded-lg px-3 py-2 md:py-1 outline-none hidden w-full md:w-auto">
                    </div>
                    <!-- Stats Cards - OPTIMIZED FOR MOBILE -->
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4">
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-blue-500" data-widget="caisse">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Solde Caisse</p>
                            <h3 id="stat-caisse" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-blue-600 flex items-center gap-1">
                                <i data-lucide="arrow-up-right" class="w-3 h-3"></i> Actif net
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-emerald-500" data-widget="chiffre-affaires">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Chiffre Affaires</p>
                            <h3 id="stat-ca" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-emerald-600 flex items-center gap-1">
                                <i data-lucide="trending-up" class="w-3 h-3"></i> Total ventes
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-amber-500" data-widget="total-depenses">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Total Dépenses</p>
                            <h3 id="stat-depenses" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-amber-600 flex items-center gap-1">
                                <i data-lucide="arrow-down-right" class="w-3 h-3"></i> Sorties caisse
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-green-500" data-widget="ventes-especes">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Ventes Espèces</p>
                            <h3 id="stat-ventes-cash" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-green-600 flex items-center gap-1">
                                <i data-lucide="dollar-sign" class="w-3 h-3"></i> Paiement comptant
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-blue-500" data-widget="ventes-mobile">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Ventes Mobile</p>
                            <h3 id="stat-ventes-mobile" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-blue-600 flex items-center gap-1">
                                <i data-lucide="smartphone" class="w-3 h-3"></i> Mobile Money
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-purple-500" data-widget="total-ventes">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Total Ventes</p>
                            <h3 id="stat-total-ventes" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-purple-600 flex items-center gap-1">
                                <i data-lucide="trending-up" class="w-3 h-3"></i> Somme ventes
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-rose-500 col-span-2 md:col-span-1" data-widget="credits-attente">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Crédits en attente</p>
                            <h3 id="stat-credits" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-rose-600 flex items-center gap-1">
                                <i data-lucide="clock" class="w-3 h-3"></i> À recevoir
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row - OPTIMIZED -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                                    <i data-lucide="trending-up" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Flux Trésorerie
                                </h4>
                                <select id="chart-period" onchange="updateMainChart()" class="text-xs border rounded-lg px-2 py-1 outline-none">
                                    <option value="7">7 jours</option>
                                    <option value="30">30 jours</option>
                                    <option value="90">3 mois</option>
                                </select>
                            </div>
                            <div class="h-48 md:h-64"><canvas id="chart-main"></canvas></div>
                        </div>
                        <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                                    <i data-lucide="alert-circle" class="w-4 h-4 md:w-5 md:h-5 text-amber-500"></i> Alertes
                                </h4>
                                <span id="alert-count" class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full font-bold">0</span>
                            </div>
                            <div id="stock-alerts" class="space-y-2 md:space-y-3 max-h-[200px] md:max-h-[250px] overflow-y-auto">
                                <!-- JS Injection -->
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions & Recent Activities - OPTIMIZED -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        <!-- Quick Actions -->
                        <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                            <h4 class="font-bold mb-3 md:mb-4 flex items-center gap-2 text-sm md:text-base">
                                <i data-lucide="zap" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Actions Rapides
                            </h4>
                            <div class="space-y-2 md:space-y-3">
                                <button onclick="requirePostePermission('stockAdd', function(){openModal('modal-product')})" class="w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 rounded-lg md:rounded-xl transition-all group touch-target">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="plus-circle" class="w-4 h-4 md:w-5 md:h-5 text-blue-600"></i>
                                        <span class="font-medium text-slate-700 text-sm md:text-base">Nouveau produit</span>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-4 h-4 text-blue-300 group-hover:text-blue-500"></i>
                                </button>
                                <button onclick="openModal('modal-stock-adjust')" class="w-full flex items-center justify-between p-3 bg-emerald-50 hover:bg-emerald-100 rounded-lg md:rounded-xl transition-all group touch-target">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="package-plus" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"></i>
                                        <span class="font-medium text-slate-700 text-sm md:text-base">Ajustement stock</span>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-4 h-4 text-emerald-300 group-hover:text-emerald-500"></i>
                                </button>
                                <button onclick="switchTab('sales')" class="w-full flex items-center justify-between p-3 bg-purple-50 hover:bg-purple-100 rounded-lg md:rounded-xl transition-all group touch-target">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="shopping-bag" class="w-4 h-4 md:w-5 md:h-5 text-purple-600"></i>
                                        <span class="font-medium text-slate-700 text-sm md:text-base">Nouvelle facture</span>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-4 h-4 text-purple-300 group-hover:text-purple-500"></i>
                                </button>
                                <button onclick="requirePostePermission('expensesAdd', function(){openModal('modal-expense')})" class="w-full flex items-center justify-between p-3 bg-amber-50 hover:bg-amber-100 rounded-lg md:rounded-xl transition-all group touch-target">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="minus-circle" class="w-4 h-4 md:w-5 md:h-5 text-amber-600"></i>
                                        <span class="font-medium text-slate-700 text-sm md:text-base">Nouvelle dépense</span>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-4 h-4 text-amber-300 group-hover:text-amber-500"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Recent Activities -->
                        <div class="glass-card rounded-xl md:rounded-2xl shadow-sm overflow-hidden md:col-span-2">
                            <div class="p-3 md:p-4 border-b bg-slate-50 flex justify-between items-center">
                                <h4 class="font-bold text-sm md:text-base">Dernières opérations</h4>
                                <button onclick="switchTab('logs')" class="text-xs text-blue-600 font-semibold hover:underline">Voir tout</button>
                            </div>
                            <div id="recent-logs" class="divide-y text-xs md:text-sm max-h-[250px] md:max-h-[300px] overflow-y-auto">
                                <!-- JS Injection -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STOCK TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-stock" class="tab-content space-y-4 md:space-y-6">
                    <div class="flex flex-col gap-3 md:gap-4">
                        <div class="grid grid-cols-1 md:flex md:flex-row gap-3 md:gap-4">
                            <div class="relative w-full">
                                <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-slate-400"></i>
                                <input type="text" id="search-stock" placeholder="Rechercher..." 
                                    class="w-full pl-10 pr-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-sm md:text-base"
                                    oninput="renderStock()">
                            </div>
                            <select id="filter-category" onchange="renderStock()" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none text-sm md:text-base">
                                <option value="">Toutes catégories</option>
                                <!-- JS Injection -->
                            </select>
                        </div>
                        <div class="grid grid-cols-3 gap-2 md:flex md:gap-2">
                            <select id="filter-stock-status" onchange="renderStock()" class="col-span-2 px-3 py-2 md:px-4 md:py-2.5 rounded-xl border border-slate-200 outline-none text-sm">
                                <option value="">Tous stocks</option>
                                <option value="critique">Critique</option>
                                <option value="zero">Épuisé</option>
                                <option value="normal">Normal</option>
                            </select>
                            <button onclick="exportStockCSV()" class="px-2 py-2 border border-slate-200 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-all flex items-center justify-center gap-1 text-sm">
                                <i data-lucide="download" class="w-3 h-3 md:w-4 md:h-4"></i> <span class="hidden md:inline">CSV</span>
                            </button>
                            <button onclick="exportStockPDF()" class="px-2 py-2 border border-slate-200 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-all flex items-center justify-center gap-1 text-sm">
                                <i data-lucide="file-text" class="w-3 h-3 md:w-4 md:h-4"></i> <span class="hidden md:inline">PDF</span>
                            </button>
                            <button onclick="document.getElementById('import-stock-file').click()" class="px-2 py-2 border border-slate-200 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-all flex items-center justify-center gap-1 text-sm">
                                <i data-lucide="upload" class="w-3 h-3 md:w-4 md:h-4"></i> <span class="hidden md:inline">Import</span>
                            </button>
                            <input type="file" id="import-stock-file" accept=".csv" style="display: none;" onchange="importStockCSV(event)">
                            <button onclick="requirePostePermission('stockAdd', function(){openModal('modal-product')})" class="px-3 py-2 bg-blue-600 text-white rounded-xl font-semibold flex items-center justify-center gap-1 hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 text-sm">
                                <i data-lucide="plus-circle" class="w-4 h-4"></i> <span class="hidden md:inline">Nouveau</span>
                            </button>
                            <button onclick="requirePostePermission('stockAdjust', function(){openModal('modal-stock-adjust')})" class="px-3 py-2 bg-emerald-600 text-white rounded-xl font-semibold flex items-center justify-center gap-1 hover:bg-emerald-700 transition-all text-sm">
                                <i data-lucide="package-plus" class="w-4 h-4"></i> <span class="hidden md:inline">Ajuster</span>
                            </button>
                        </div>
                    </div>

                    <!-- Mobile-friendly stock table -->
                    <div class="mobile-only space-y-3" id="mobile-stock-list">
                        <!-- Will be populated by JavaScript for mobile -->
                    </div>

                    <!-- Desktop table (hidden on mobile) -->
                    <div class="desktop-only glass-card rounded-2xl overflow-hidden shadow-sm overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b">
                                <tr>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Matériel</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Catégorie</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Fournisseur</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">Achat (Ar)</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">Vente (Ar)</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-center">En Stock</th>
                                    <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="stock-table-body" class="divide-y divide-slate-100">
                                <!-- JS Injection -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Total value - visible on both -->
                    <div class="glass-card p-4 rounded-xl shadow-sm">
                        <div class="flex justify-between items-center">
                            <div class="text-sm font-bold text-slate-700">Valeur totale du stock :</div>
                            <div class="text-lg font-bold text-blue-600" id="total-stock-value">0 Ar</div>
                        </div>
                    </div>

                    <!-- Stock Movements History -->
                    <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                        <h4 class="font-bold mb-3 md:mb-4 flex items-center gap-2 text-sm md:text-base">
                            <i data-lucide="activity" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Historique stock
                        </h4>
                        <div id="stock-movements" class="space-y-2 md:space-y-3 max-h-[200px] md:max-h-[300px] overflow-y-auto">
                            <!-- JS Injection -->
                        </div>
                    </div>
                </div>

                <!-- SALES TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-sales" class="tab-content space-y-4 md:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        <!-- POS Side -->
                        <div class="md:col-span-2 space-y-4">
                            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                                <div class="flex justify-between items-center mb-4 md:mb-6">
                                    <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                                        <i data-lucide="shopping-bag" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Nouvelle Facture
                                    </h4>
                                    <div class="text-xs md:text-sm text-slate-500">
                                        <span id="invoice-number">Facture #001</span>
                                    </div>
                                </div>
                                
                                <!-- Client Information -->
                                <div class="mb-4 md:mb-6 p-3 md:p-4 bg-slate-50 rounded-xl">
                                    <h5 class="font-bold text-xs md:text-sm mb-2 md:mb-3 flex items-center gap-2">
                                        <i data-lucide="user" class="w-3 h-3 md:w-4 md:h-4"></i> Client (Optionnel)
                                    </h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nom</label>
                                            <input type="text" id="client-name" placeholder="Nom complet ou laisser vide" 
                                                class="w-full px-3 md:px-4 py-2.5 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm md:text-base">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Téléphone</label>
                                            <input type="text" id="client-phone" placeholder="+261 XX XX XXX XX" 
                                                class="w-full px-3 md:px-4 py-2.5 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm md:text-base">
                                        </div>
                                    </div>
                                </div>

                                <!-- Cart Items -->
                                <div class="mb-4 md:mb-6">
                                    <div class="flex justify-between items-center mb-2 md:mb-3">
                                        <h5 class="font-bold text-xs md:text-sm flex items-center gap-2">
                                            <i data-lucide="shopping-cart" class="w-3 h-3 md:w-4 md:h-4"></i> Articles
                                        </h5>
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs text-slate-500" id="cart-count">0 article(s)</span>
                                            <span class="text-xs text-slate-400">|</span>
                                            <span class="text-xs font-medium text-slate-600">Actions</span>
                                            <button onclick="clearCart()" id="clear-cart-btn" class="hidden text-xs text-red-500 hover:text-red-700 font-medium transition-colors">
                                                <i data-lucide="x-circle" class="w-3 h-3 inline mr-1"></i>Vider
                                            </button>
                                        </div>
                                    </div>
                                    <div class="space-y-2 md:space-y-4" id="cart-items">
                                        <!-- Cart items will be added here -->
                                        <div class="text-center py-6 md:py-8 text-slate-400">
                                            <i data-lucide="shopping-cart" class="w-8 h-8 md:w-12 md:h-12 mx-auto mb-2 opacity-30"></i>
                                            <p class="text-sm">Aucun article ajouté</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Add Product Form -->
                                <div class="p-3 md:p-4 bg-blue-50 rounded-xl mb-4 md:mb-6">
                                    <h6 class="font-bold text-xs md:text-sm mb-2 md:mb-3 flex items-center gap-2">
                                        <i data-lucide="plus-circle" class="w-3 h-3 md:w-4 md:h-4"></i> Ajouter article
                                    </h6>
                                    <div class="space-y-3 md:space-y-4">
                                        <!-- Recherche de produit -->
                                        <div class="relative">
                                            <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-slate-400"></i>
                                            <input type="text" id="product-search" placeholder="Rechercher un produit..." oninput="filterProducts(this.value)" class="w-full pl-10 pr-4 py-3 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm md:text-base">
                                        </div>
                                        
                                        <!-- Formulaire détaillé -->
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
                                            <div>
                                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Produit</label>
                                                <select id="sale-product" onchange="updateSalePrice()" class="w-full px-3 md:px-4 py-2.5 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm md:text-base">
                                                    <!-- JS Injection -->
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Quantité</label>
                                                <div class="flex gap-1">
                                                    <input type="number" id="sale-qty" value="1" min="1" onchange="updateSalePrice()" 
                                                        class="w-28 px-3 md:px-4 py-2.5 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm md:text-base">
                                                    <input type="number" id="sale-price" readonly 
                                                        class="w-32 px-3 md:px-4 py-2.5 rounded-lg border border-slate-200 bg-slate-50 text-slate-500 text-sm md:text-base">
                                                    <button type="button" onclick="addToCart()" class="px-3 md:px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 touch-target">
                                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Payment & Summary -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                                    <div class="space-y-3 md:space-y-4">
                                        <div class="p-3 md:p-4 bg-slate-50 rounded-xl">
                                            <h6 class="font-bold text-xs md:text-sm mb-2">Paiement</h6>
                                            <div class="grid grid-cols-3 gap-1 md:gap-2 md:space-y-2">
                                                <label class="flex flex-col items-center gap-1 cursor-pointer p-2 rounded-lg border">
                                                    <input type="radio" name="payment-method" value="cash" checked class="rounded">
                                                    <span class="text-xs text-center">Espèces</span>
                                                </label>
                                                <label class="flex flex-col items-center gap-1 cursor-pointer p-2 rounded-lg border">
                                                    <input type="radio" name="payment-method" value="credit" class="rounded">
                                                    <span class="text-xs text-center">Crédit</span>
                                                </label>
                                                <label class="flex flex-col items-center gap-1 cursor-pointer p-2 rounded-lg border">
                                                    <input type="radio" name="payment-method" value="mobile" class="rounded">
                                                    <span class="text-xs text-center">Mobile</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="p-3 md:p-4 bg-emerald-50 rounded-xl">
                                        <h6 class="font-bold text-xs md:text-sm mb-2">Récapitulatif</h6>
                                        <div class="space-y-1 md:space-y-2 text-xs md:text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-slate-600">Sous-total :</span>
                                                <span id="invoice-subtotal" class="font-bold">0 Ar</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-slate-600">Total :</span>
                                                <span id="invoice-total" class="font-bold text-lg md:text-xl text-blue-600">0 Ar</span>
                                            </div>
                                            <div id="credit-info" class="hidden mt-2 p-2 bg-amber-100 text-amber-800 rounded text-xs">
                                                <i data-lucide="alert-circle" class="w-3 h-3 inline mr-1"></i>
                                                Enregistré comme crédit
                                            </div>
                                            <button onclick="completeSale()" class="w-full mt-3 md:mt-4 py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 transition-all flex items-center justify-center gap-2 touch-target">
                                                <i data-lucide="check-circle" class="w-4 h-4 md:w-5 md:h-5"></i> Finaliser
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- History Side -->
                        <div class="md:col-span-1 space-y-4">
                            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                                <div class="flex items-center justify-between mb-4 md:mb-6">
                                    <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                                        <i data-lucide="list" class="w-4 h-4 md:w-5 md:h-5 text-slate-400"></i> Factures
                                    </h4>
                                    <div class="text-xs text-slate-400">Aujourd'hui: <span id="sales-today-count" class="font-bold text-slate-600">0</span></div>
                                </div>
                                
                                <!-- Filtre par date -->
                                <div class="mb-4 space-y-3">
                                    <div class="flex flex-col sm:flex-row gap-2">
                                        <div class="flex-1">
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Date début</label>
                                            <input type="date" id="invoice-filter-start" onchange="filterInvoices()" 
                                                class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Date fin</label>
                                            <input type="date" id="invoice-filter-end" onchange="filterInvoices()" 
                                                class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="setTodayFilter()" class="px-3 py-1.5 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-xs font-medium transition-colors">
                                            Aujourd'hui
                                        </button>
                                        <button onclick="setWeekFilter()" class="px-3 py-1.5 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-xs font-medium transition-colors">
                                            Cette semaine
                                        </button>
                                        <button onclick="setMonthFilter()" class="px-3 py-1.5 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-xs font-medium transition-colors">
                                            Ce mois
                                        </button>
                                        <button onclick="clearInvoiceFilter()" class="px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-xs font-medium transition-colors">
                                            Effacer
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="recent-invoices" class="space-y-2 md:space-y-3 max-h-[400px] md:max-h-[500px] overflow-y-auto">
                                    <!-- JS Injection -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CREDITS TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-credits" class="tab-content space-y-4 md:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        <div class="md:col-span-1 space-y-4">
                            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-rose-500">
                                <h4 class="font-bold mb-4 md:mb-6 flex items-center gap-2 text-sm md:text-base">
                                    <i data-lucide="dollar-sign" class="w-4 h-4 md:w-5 md:h-5 text-rose-500"></i> Règlement
                                </h4>
                                <form id="form-credit-payment" class="space-y-3 md:space-y-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Sélectionner</label>
                                        <select id="credit-select" required class="w-full px-3 md:px-4 py-2.5 md:py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-rose-500 outline-none text-sm md:text-base">
                                            <option value="">-- Choisir --</option>
                                            <!-- JS Injection -->
                                        </select>
                                    </div>
                                    <div id="credit-details" class="hidden p-3 bg-rose-50 rounded-lg text-xs md:text-sm">
                                        <div class="space-y-1">
                                            <div class="flex justify-between">
                                                <span class="text-slate-600">Client:</span>
                                                <span id="credit-client" class="font-bold"></span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-slate-600">Reste:</span>
                                                <span id="credit-balance" class="font-bold text-rose-600"></span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-slate-600">Date:</span>
                                                <span id="credit-date" class="text-slate-500 text-xs"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Montant (Ar)</label>
                                        <input type="number" id="credit-payment-amount" required placeholder="0" 
                                            class="w-full px-3 md:px-4 py-2.5 md:py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-rose-500 outline-none text-sm md:text-base">
                                    </div>
                                    <button type="submit" class="w-full py-3 md:py-4 bg-rose-600 text-white rounded-xl font-bold hover:bg-rose-700 transition-all touch-target">
                                        Enregistrer
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <div class="glass-card rounded-xl md:rounded-2xl overflow-hidden shadow-sm">
                                <div class="p-3 md:p-4 bg-slate-50 border-b flex justify-between items-center">
                                    <h4 class="font-bold text-sm md:text-base">Crédits en cours</h4>
                                    <span id="total-credits" class="text-sm font-bold text-rose-600">0 Ar</span>
                                </div>
                                
                                <!-- Mobile credits list -->
                                <div class="mobile-only space-y-2 p-3" id="mobile-credits-list">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                                
                                <!-- Desktop table -->
                                <div class="desktop-only overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead class="bg-white border-b">
                                            <tr>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Client</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Facture</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Date</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Total</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Payé</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Reste</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-center">Statut</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="credits-table-body" class="divide-y divide-slate-100 text-sm">
                                            <!-- JS Injection -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- EXPENSES TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-expenses" class="tab-content space-y-4 md:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        <div class="md:col-span-1 space-y-4">
                            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-amber-500">
                                <h4 class="font-bold mb-4 md:mb-6 flex items-center gap-2 text-sm md:text-base">
                                    <i data-lucide="minus-circle" class="w-4 h-4 md:w-5 md:h-5 text-amber-500"></i> Sortie Caisse
                                </h4>
                                <form id="form-expense" class="space-y-3 md:space-y-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Catégorie</label>
                                        <div class="space-y-2">
                                            <select id="expense-category" required class="w-full px-3 md:px-4 py-2.5 md:py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-amber-500 outline-none text-sm md:text-base">
                                                <option value="">Sélectionner</option>
                                                <!-- Options will be populated by JavaScript -->
                                            </select>
                                            <div class="flex gap-2">
                                                <input type="text" id="new-category-input" placeholder="Nouvelle catégorie..." 
                                                    class="flex-1 px-3 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-amber-500 outline-none text-sm">
                                                <button type="button" onclick="addExpenseCategory()" class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-all">
                                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Motif</label>
                                        <input type="text" id="expense-motif" required placeholder="Ex: Loyer..." 
                                            class="w-full px-3 md:px-4 py-2.5 md:py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-amber-500 outline-none text-sm md:text-base">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Date</label>
                                        <input type="date" id="expense-date" required
                                            class="w-full px-3 md:px-4 py-2.5 md:py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-amber-500 outline-none text-sm md:text-base">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Montant (Ar)</label>
                                        <input type="number" id="expense-amount" required placeholder="0" min="1"
                                            class="w-full px-3 md:px-4 py-2.5 md:py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-amber-500 outline-none text-sm md:text-base">
                                    </div>
                                    <button type="submit" class="w-full py-3 md:py-4 bg-amber-600 text-white rounded-xl font-bold hover:bg-amber-700 transition-all touch-target">
                                        Enregistrer
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <div class="glass-card rounded-xl md:rounded-2xl overflow-hidden shadow-sm">
                                <div class="p-3 md:p-4 bg-slate-50 border-b flex justify-between items-center">
                                    <h4 class="font-bold text-sm md:text-base">Dépenses</h4>
                                    <button onclick="exportExpensesCSV()" class="text-xs text-slate-500 hover:text-slate-700 flex items-center gap-1">
                                        <i data-lucide="download" class="w-3 h-3"></i> <span class="hidden md:inline">Export</span>
                                    </button>
                                </div>
                                <div class="p-3 md:p-4 border-b flex gap-2 md:gap-4">
                                    <select id="expense-filter-category" onchange="renderExpenses()" class="px-2 md:px-3 py-1 border rounded text-xs md:text-sm outline-none flex-1">
                                        <option value="">Toutes catégories</option>
                                        <!-- JS Injection -->
                                    </select>
                                    <input type="month" id="expense-filter-month" onchange="renderExpenses()" class="px-2 md:px-3 py-1 border rounded text-xs md:text-sm outline-none">
                                </div>
                                
                                <!-- Mobile expenses list -->
                                <div class="mobile-only space-y-2 p-3" id="mobile-expenses-list">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                                
                                <!-- Desktop table -->
                                <div class="desktop-only overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead class="bg-white border-b">
                                            <tr>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Date</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Catégorie</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Description</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Montant</th>
                                                <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="expenses-table-body" class="divide-y divide-slate-100 text-sm">
                                            <!-- JS Injection -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Total footer -->
                                <div class="p-3 md:p-4 border-t bg-slate-50">
                                    <div class="flex justify-between items-center">
                                        <div class="font-bold text-sm md:text-base">Total :</div>
                                        <div id="total-expenses" class="font-bold text-amber-600 text-lg md:text-xl">0 Ar</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LOGS TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-logs" class="tab-content space-y-4">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-2">
                        <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                            <i data-lucide="database" class="w-4 h-4 md:w-5 md:h-5"></i> Journal système
                        </h4>
                        <div class="flex gap-2">
                            <select id="log-filter-type" onchange="renderLogs()" class="text-xs border rounded px-2 py-1 outline-none flex-1">
                                <option value="">Tous types</option>
                                <option value="info">Info</option>
                                <option value="warning">Avertissement</option>
                                <option value="error">Erreur</option>
                                <option value="success">Succès</option>
                            </select>
                            <button onclick="clearLogs()" class="text-xs text-red-500 font-semibold hover:underline whitespace-nowrap">Vider</button>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl md:rounded-2xl shadow-sm overflow-hidden">
                        <div id="full-logs-list" class="divide-y max-h-[500px] md:max-h-[600px] overflow-y-auto">
                            <!-- JS Injection -->
                        </div>
                    </div>
                </div>

                <!-- REPORTS TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-reports" class="tab-content space-y-4 md:space-y-6">
                    <div class="flex items-center justify-end gap-3">
                        <select id="reports-period" onchange="onReportsPeriodChange()" class="text-xs md:text-sm border rounded-lg px-3 py-2 md:py-1 outline-none w-full md:w-auto">
                            <option value="today">Aujourd'hui</option>
                            <option value="week">7 derniers jours</option>
                            <option value="month">30 derniers jours</option>
                            <option value="year">Cette année</option>
                            <option value="all" selected>Tous</option>
                            <option value="custom">Date précise</option>
                        </select>
                        <input id="reports-date" type="date" class="text-xs md:text-sm border rounded-lg px-3 py-2 md:py-1 outline-none hidden w-full md:w-auto">
                        <button onclick="generatePDFReport()" class="bg-blue-600 text-white px-3 md:px-4 py-2 rounded-lg text-xs md:text-sm font-semibold hover:bg-blue-700 touch-target">
                            <i data-lucide="download" class="w-4 h-4 inline mr-1"></i> PDF
                        </button>
                    </div>

                    <!-- Report Summary Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4">
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-blue-500">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Total Ventes</p>
                            <h3 id="report-total-sales" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-blue-600 flex items-center gap-1">
                                <i data-lucide="shopping-cart" class="w-3 h-3"></i> Factures
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-emerald-500">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Total Dépenses</p>
                            <h3 id="report-total-expenses" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-emerald-600 flex items-center gap-1">
                                <i data-lucide="receipt" class="w-3 h-3"></i> Sorties
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-purple-500">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Bénéfice Net</p>
                            <h3 id="report-net-profit" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-purple-600 flex items-center gap-1">
                                <i data-lucide="trending-up" class="w-3 h-3"></i> Profit
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-amber-500">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Crédits Restants</p>
                            <h3 id="report-credits" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">0 Ar</h3>
                            <div class="mt-1 md:mt-2 text-xs text-amber-600 flex items-center gap-1">
                                <i data-lucide="credit-card" class="w-3 h-3"></i> À recevoir
                            </div>
                        </div>
                        <div class="glass-card p-4 md:p-5 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-rose-500">
                            <p class="text-slate-500 text-xs md:text-sm font-medium truncate">Meilleur Client</p>
                            <h3 id="report-best-customer" class="text-lg md:text-2xl font-bold mt-1 text-slate-800 truncate">-</h3>
                            <div class="mt-1 md:mt-2 text-xs text-rose-600 flex items-center gap-1">
                                <i data-lucide="award" class="w-3 h-3"></i> Top acheteur
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Reports -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <!-- Sales Report -->
                        <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                            <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                                <i data-lucide="shopping-cart" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Détail Ventes
                            </h4>
                            <div class="space-y-2 max-h-[300px] overflow-y-auto">
                                <div id="report-sales-list">
                                    <!-- JS Injection -->
                                </div>
                            </div>
                        </div>

                        <!-- Expenses Report -->
                        <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                            <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                                <i data-lucide="receipt" class="w-4 h-4 md:w-5 md:h-5 text-emerald-500"></i> Détail Dépenses
                            </h4>
                            <div class="space-y-2 max-h-[300px] overflow-y-auto">
                                <div id="report-expenses-list">
                                    <!-- JS Injection -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Products Section -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <!-- Top Products by Revenue -->
                        <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                            <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                                <i data-lucide="trending-up" class="w-4 h-4 md:w-5 md:h-5 text-purple-500"></i> Produits les plus vendus (par revenus)
                            </h4>
                            <div class="grid grid-cols-1 gap-3 md:gap-4">
                                <div id="report-top-products-revenue">
                                    <!-- JS Injection -->
                                </div>
                            </div>
                        </div>

                        <!-- Top Products by Quantity -->
                        <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
                            <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                                <i data-lucide="package" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Produits les plus vendus (par quantité)
                            </h4>
                            <div class="grid grid-cols-1 gap-3 md:gap-4">
                                <div id="report-top-products-quantity">
                                    <!-- JS Injection -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SETTINGS TAB - OPTIMIZED FOR MOBILE -->
                <div id="tab-settings" class="tab-content">
    <!-- Settings Header -->
    <div class="mb-6 md:mb-8">
        <h2 class="text-xl md:text-2xl font-bold text-slate-800 mb-2">Paramètres</h2>
        <p class="text-slate-600 text-sm md:text-base">Configurez votre application selon vos besoins</p>
    </div>

    <!-- Settings Grid Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
        
        <!-- Left Column - Main Settings -->
        <div class="lg:col-span-2 space-y-4 md:space-y-6">
            
            <!-- Company Information -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-blue-500">
                <div class="flex items-center justify-between mb-4 md:mb-6">
                    <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                        <i data-lucide="building" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Informations Entreprise
                    </h4>
                    <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium">Essentiel</span>
                </div>
                <div class="space-y-3 md:space-y-4">
                    <!-- Logo and Name Row -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Logo</label>
                            <div class="flex items-center gap-3">
                                <div id="logo-preview" class="w-12 h-12 border-2 border-dashed border-slate-300 rounded-lg flex items-center justify-center bg-slate-50">
                                    <i data-lucide="image" class="w-5 h-5 text-slate-400"></i>
                                </div>
                                <div class="flex-1">
                                    <input type="file" id="logo-upload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                                    <button onclick="document.getElementById('logo-upload').click()" 
                                        class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs font-medium text-slate-700 hover:bg-slate-50 transition-all">
                                        Choisir
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Nom *</label>
                            <input type="text" id="company-name" value="INFO PLUS (PORT-BERGE)" 
                                class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                    </div>
                    
                    <!-- Contact Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Téléphone</label>
                            <input type="text" id="company-phone" placeholder="+261 XX XX XXX XX" 
                                class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Email</label>
                            <input type="email" id="company-email" placeholder="contact@entreprise.mg" 
                                class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                    </div>
                    
                    <!-- Additional Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Adresse</label>
                            <input type="text" id="company-address" placeholder="Adresse complète" 
                                class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">NIF/STAT</label>
                            <input type="text" id="company-nif" placeholder="N° d'immatriculation" 
                                class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1 md:mb-2">Signature documents</label>
                        <input type="text" id="company-signature" placeholder="Le Gérant" 
                            class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                    </div>
                    
                    <button onclick="updateCompanyInfo()" class="w-full px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-all">
                        Enregistrer les informations
                    </button>
                </div>
            </div>

            <!-- Dashboard Configuration -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-purple-500">
                <div class="flex items-center justify-between mb-4 md:mb-6">
                    <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                        <i data-lucide="layout-grid" class="w-4 h-4 md:w-5 md:h-5 text-purple-500"></i> Tableau de bord
                    </h4>
                    <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-medium">Personnalisation</span>
                </div>
                <div class="space-y-4">
                    <p class="text-sm text-slate-600">Sélectionnez les widgets à afficher :</p>
                    
                    <!-- Widget Selection Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group">
                            <input type="checkbox" id="widget-caisse" onchange="updateDashboardWidgets()" class="w-4 h-4 rounded text-purple-600">
                            <div class="flex-1">
                                <div class="font-medium text-slate-700 text-sm">Solde Caisse</div>
                                <div class="text-xs text-slate-500">État financier actuel</div>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group">
                            <input type="checkbox" id="widget-chiffre-affaires" onchange="updateDashboardWidgets()" class="w-4 h-4 rounded text-purple-600">
                            <div class="flex-1">
                                <div class="font-medium text-slate-700 text-sm">Chiffre d'Affaires</div>
                                <div class="text-xs text-slate-500">Total des ventes</div>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group">
                            <input type="checkbox" id="widget-total-depenses" onchange="updateDashboardWidgets()" class="w-4 h-4 rounded text-purple-600">
                            <div class="flex-1">
                                <div class="font-medium text-slate-700 text-sm">Dépenses</div>
                                <div class="text-xs text-slate-500">Sorties de caisse</div>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group">
                            <input type="checkbox" id="widget-ventes-especes" onchange="updateDashboardWidgets()" class="w-4 h-4 rounded text-purple-600">
                            <div class="flex-1">
                                <div class="font-medium text-slate-700 text-sm">Ventes Espèces</div>
                                <div class="text-xs text-slate-500">Paiements comptants</div>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group">
                            <input type="checkbox" id="widget-ventes-mobile" onchange="updateDashboardWidgets()" class="w-4 h-4 rounded text-purple-600">
                            <div class="flex-1">
                                <div class="font-medium text-slate-700 text-sm">Ventes Mobile</div>
                                <div class="text-xs text-slate-500">Mobile Money</div>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group">
                            <input type="checkbox" id="widget-total-ventes" onchange="updateDashboardWidgets()" class="w-4 h-4 rounded text-purple-600">
                            <div class="flex-1">
                                <div class="font-medium text-slate-700 text-sm">Total Ventes</div>
                                <div class="text-xs text-slate-500">Somme complète</div>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group">
                            <input type="checkbox" id="widget-credits-attente" onchange="updateDashboardWidgets()" class="w-4 h-4 rounded text-purple-600">
                            <div class="flex-1">
                                <div class="font-medium text-slate-700 text-sm">Crédits en attente</div>
                                <div class="text-xs text-slate-500">À recevoir</div>
                            </div>
                        </label>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="flex gap-2 pt-2 border-t">
                        <button onclick="selectAllDashboardWidgets()" class="px-3 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 transition-all">
                            Tout sélectionner
                        </button>
                        <button onclick="deselectAllDashboardWidgets()" class="px-3 py-2 bg-slate-600 text-white rounded-lg text-sm font-medium hover:bg-slate-700 transition-all">
                            Tout désélectionner
                        </button>
                    </div>
                </div>
            </div>

            <!-- Multiposte Management -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-amber-500">
                <div class="flex items-center justify-between mb-4 md:mb-6">
                    <h4 class="font-bold flex items-center gap-2 text-sm md:text-base">
                        <i data-lucide="users" class="w-4 h-4 md:w-5 md:h-5 text-amber-500"></i> Gestion Multi-postes
                    </h4>
                    <span class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full font-medium">Avancé</span>
                </div>
                <div class="space-y-4">
                    <div class="p-3 bg-amber-50 rounded-xl">
                        <label class="flex items-center justify-between cursor-pointer">
                            <span class="font-medium text-slate-700 text-sm">Activer le mode multiposte</span>
                            <input type="checkbox" id="multiposte-enabled" onchange="toggleMultiposte()" class="w-5 h-5 rounded">
                        </label>
                        <p class="text-xs text-slate-500 mt-1">Chaque poste se connecte avec son propre compte</p>
                    </div>
                    
                    <div id="postes-list-container" class="space-y-3">
                        <div class="flex justify-between items-center">
                            <h5 class="font-semibold text-slate-700 text-sm">Postes configurés</h5>
                            <button onclick="openModal('modal-poste')" class="px-3 py-2 bg-amber-600 text-white rounded-lg text-sm font-medium hover:bg-amber-700 flex items-center gap-1">
                                <i data-lucide="plus" class="w-4 h-4"></i> Nouveau
                            </button>
                        </div>
                        <div id="postes-list" class="space-y-2">
                            <!-- JS: list of postes -->
                        </div>
                    </div>
                    
                    <div id="poste-current-info" class="p-3 bg-slate-50 rounded-xl text-sm hidden">
                        <span class="text-slate-500">Connecté en tant que :</span>
                        <strong id="current-poste-name"></strong>
                        <button onclick="logoutPoste(); location.reload();" class="ml-2 text-blue-600 hover:underline">Changer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Quick Actions & Status -->
        <div class="space-y-4 md:space-y-6">
            
            <!-- Quick Status Card -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-green-500">
                <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                    <i data-lucide="activity" class="w-4 h-4 md:w-5 md:h-5 text-green-500"></i> État du système
                </h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-2 bg-green-50 rounded-lg">
                        <span class="text-sm font-medium text-slate-700">Application</span>
                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">Active</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <span class="text-sm font-medium text-slate-700">Version</span>
                        <span class="text-xs text-slate-600">v1.0.0 Goaka</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <span class="text-sm font-medium text-slate-700">Dernière sauvegarde</span>
                        <span class="text-xs text-slate-600">Auto</span>
                    </div>
                </div>
            </div>

            <!-- Security Settings -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-red-500">
                <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                    <i data-lucide="lock" class="w-4 h-4 md:w-5 md:h-5 text-red-500"></i> Sécurité
                </h4>
                <div class="space-y-3">
                    <div class="p-3 bg-red-50 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-bold text-slate-700 text-sm">Protection suppressions</div>
                                <div class="text-xs text-slate-500">Mot de passe requis pour les actions critiques</div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="auth-enabled" checked class="sr-only peer">
                                <div class="w-10 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                            </label>
                        </div>
                    </div>
                    
                    <div id="auth-config" class="space-y-3">
                        <div class="border-t pt-3">
                            <h5 class="font-semibold text-slate-700 text-sm mb-3">Changer le mot de passe administrateur</h5>
                            <div class="space-y-2">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Mot de passe actuel</label>
                                    <input type="password" id="current-password" 
                                        class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-red-500 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nouveau mot de passe</label>
                                    <input type="password" id="new-password" 
                                        class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-red-500 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Confirmer le mot de passe</label>
                                    <input type="password" id="confirm-password" 
                                        class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-red-500 text-sm">
                                </div>
                                <button onclick="updatePassword()" class="w-full px-3 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 transition-all">
                                    Mettre à jour le mot de passe
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- License & Support -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-blue-500">
                <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                    <i data-lucide="shield-check" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Licence & Support
                </h4>
                <div class="space-y-3">
                    <div class="p-3 bg-blue-50 rounded-xl">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-slate-700">Statut de la licence</span>
                            <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">Essai</span>
                        </div>
                        <p class="text-xs text-slate-600 mb-3">Version d'essai gratuite</p>
                        <button onclick="document.getElementById('license-overlay').style.display = 'flex'" 
                                class="w-full px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-all">
                            Activer la version complète
                        </button>
                    </div>
                    
                    <div class="text-center p-3 bg-slate-50 rounded-xl">
                        <p class="text-xs text-slate-500 mb-2">Besoin d'aide ?</p>
                        <button class="text-xs text-blue-600 hover:underline font-medium">Contacter le support</button>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-slate-500">
                <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                    <i data-lucide="database" class="w-4 h-4 md:w-5 md:h-5 text-slate-500"></i> Gestion des données
                </h4>
                <div class="space-y-3">
                    <p class="text-xs md:text-sm text-slate-500 italic mb-3">Sauvegardez ou restaurez vos données</p>
                    
                    <button onclick="exportData()" class="w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-blue-50 rounded-lg transition-all group">
                        <div class="flex items-center gap-3">
                            <i data-lucide="download" class="w-4 h-4 text-blue-600"></i>
                            <div class="text-left">
                                <div class="font-bold text-slate-700 text-sm">Exporter les données</div>
                                <div class="text-[10px] text-slate-400">Backup .json complet</div>
                            </div>
                        </div>
                        <i data-lucide="chevron-right" class="w-4 h-4 text-slate-300 group-hover:text-blue-400"></i>
                    </button>

                    <label class="w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-emerald-50 rounded-lg transition-all group cursor-pointer">
                        <div class="flex items-center gap-3">
                            <i data-lucide="upload" class="w-4 h-4 text-emerald-600"></i>
                            <div class="text-left">
                                <div class="font-bold text-slate-700 text-sm">Importer les données</div>
                                <div class="text-[10px] text-slate-400">Charger un backup</div>
                            </div>
                        </div>
                        <input type="file" class="hidden" onchange="importData(event)" accept=".json">
                        <i data-lucide="chevron-right" class="w-4 h-4 text-slate-300 group-hover:text-emerald-400"></i>
                    </label>

                    <button onclick="triggerReset()" class="w-full flex items-center justify-between p-3 bg-red-50 hover:bg-red-100 rounded-lg transition-all group">
                        <div class="flex items-center gap-3 text-red-600">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            <div class="text-left">
                                <div class="font-bold text-sm">Réinitialisation complète</div>
                                <div class="text-[10px] text-red-400 opacity-70">⚠️ Attention - perte de données</div>
                            </div>
                        </div>
                    </button>
                    
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg mt-3">
                        <span class="text-slate-500 text-xs">Stockage utilisé</span>
                        <span id="storage-size" class="font-semibold text-xs text-blue-600">0 KB</span>
                    </div>
                </div>
            </div>

            <!-- System Info -->
            <div class="glass-card p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm border-l-4 border-blue-500">
                <h4 class="font-bold mb-4 flex items-center gap-2 text-sm md:text-base">
                    <i data-lucide="info" class="w-4 h-4 md:w-5 md:h-5 text-blue-500"></i> Informations système
                </h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-slate-500 text-xs">Application</span>
                        <span class="font-semibold text-xs">Enterprise Management Pro</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-slate-500 text-xs">Version</span>
                        <span class="font-semibold text-xs">v2.3 Goaka Edition</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-slate-500 text-xs">Mise à jour</span>
                        <span class="font-semibold text-xs">17 Fév 2026</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-slate-500 text-xs">Navigateur</span>
                        <span id="browser-info" class="font-semibold text-xs">-</span>
                    </div>
                    
                    <div class="mt-4 p-3 bg-slate-100 rounded-xl text-center">
                        <div class="text-lg font-black text-slate-300 mb-2" id="settings-company-name">INFO PLUS (PORT-BERGE)</div>
                        <div class="text-[10px] uppercase tracking-widest font-bold text-slate-400">Gestion Premium</div>
                        <div class="text-[8px] text-slate-400 mt-2">© 2024 - Tous droits réservés</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

            <!-- MOBILE NAV BAR - IMPROVED -->
            <nav class="mobile-nav fixed bottom-0 left-0 right-0 h-16 bg-white/95 backdrop-blur-sm border-t z-50 flex items-center justify-around px-2 md:hidden">
                <button onclick="switchTab('dashboard')" class="flex flex-col items-center gap-1 text-slate-400 px-2 py-1 mobile-link active touch-target" data-tab="dashboard">
                    <i data-lucide="home" class="w-5 h-5"></i>
                    <span class="text-[10px]">Accueil</span>
                </button>
                <button onclick="switchTab('stock')" class="flex flex-col items-center gap-1 text-slate-400 px-2 py-1 mobile-link touch-target" data-tab="stock">
                    <i data-lucide="package" class="w-5 h-5"></i>
                    <span class="text-[10px]">Stock</span>
                </button>
                <button onclick="switchTab('sales')" class="flex flex-col items-center gap-1 text-slate-400 px-2 py-1 mobile-link touch-target" data-tab="sales">
                    <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                    <span class="text-[10px]">Ventes</span>
                </button>
                <button onclick="switchTab('credits')" class="flex flex-col items-center gap-1 text-slate-400 px-2 py-1 mobile-link touch-target" data-tab="credits">
                    <i data-lucide="credit-card" class="w-5 h-5"></i>
                    <span class="text-[10px]">Crédits</span>
                </button>
                <button id="mobile-menu-btn-bottom" class="flex flex-col items-center gap-1 text-slate-400 px-2 py-1 touch-target" data-tab="menu">
                    <i data-lucide="menu" class="w-5 h-5"></i>
                    <span class="text-[10px]">Menu</span>
                </button>
            </nav>

        </main>
    </div>

    <!-- MODALS - OPTIMIZED FOR MOBILE -->
    <!-- Modal Connexion Administrateur -->
<div id="modal-admin-login" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[115] hidden flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-sm rounded-2xl md:rounded-3xl shadow-2xl p-6 md:p-8 text-center animate-fadeIn">
        <div class="w-16 h-16 md:w-20 md:h-20 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6">
            <i data-lucide="user-cog" class="w-8 h-8 md:w-10 md:h-10"></i>
        </div>
        <h3 class="text-lg md:text-xl font-bold text-slate-800 mb-2">Connexion Administrateur</h3>
        <p class="text-slate-500 text-sm mb-4 md:mb-6">Entrez votre mot de passe administrateur</p>
        
        <div class="space-y-4">
            <div>
                <input type="password" id="admin-login-password" placeholder="Mot de passe administrateur" 
                    class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-purple-500 text-sm md:text-base"
                    onkeypress="if(event.key === 'Enter') executeAdminLogin()">
            </div>
            
            <div id="admin-login-error" class="hidden text-red-500 text-sm p-2 bg-red-50 rounded-lg"></div>
            
            <div class="flex gap-3 pt-2">
                <button onclick="closeModal('modal-admin-login')" class="flex-1 px-4 py-3 font-bold text-slate-600 border border-slate-200 rounded-xl hover:bg-slate-50 touch-target">
                    Annuler
                </button>
                <button onclick="executeAdminLogin()" class="flex-1 px-4 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 touch-target">
                    Se connecter
                </button>
            </div>
            
            <div class="text-center">
                <button class="text-xs text-amber-600 hover:text-amber-700 hover:underline">
                    Mot de passe oublié ?
                </button>
            </div>
        </div>
    </div>
</div>
    <!-- Modal Produit -->
    <div id="modal-product" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-lg rounded-2xl md:rounded-3xl shadow-2xl overflow-hidden animate-fadeIn max-h-[90vh] overflow-y-auto">
            <div class="p-4 md:p-6 border-b flex justify-between items-center bg-white sticky top-0">
                <h3 id="product-modal-title" class="text-lg md:text-xl font-bold text-slate-800">Nouveau Matériel</h3>
                <button onclick="closeModal('modal-product')" class="p-2 hover:bg-slate-100 rounded-full transition-colors touch-target"><i data-lucide="x"></i></button>
            </div>
            <form id="form-product" class="p-4 md:p-6 space-y-4 bg-white">
                <input type="hidden" id="edit-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Nom *</label>
                        <input type="text" id="prod-nom" required class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Catégorie</label>
                        <input type="text" id="prod-category" placeholder="Ex: Électronique" class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Fournisseur</label>
                        <input type="text" id="prod-fournisseur" class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Prix Achat *</label>
                        <input type="number" id="prod-achat" required min="1" class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Prix Vente *</label>
                        <input type="number" id="prod-vente" required min="1" class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Stock *</label>
                        <input type="number" id="prod-stock" required min="0" class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Alerte Mini</label>
                        <input type="number" id="prod-min" value="5" min="0" class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                    </div>
                </div>
                <div class="text-xs text-slate-400 italic">* Champs obligatoires</div>
                <div id="product-error" class="hidden p-3 bg-red-50 text-red-600 rounded-lg text-sm"></div>
                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeModal('modal-product')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-slate-500 hover:bg-slate-50 transition-all touch-target">Annuler</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all touch-target">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Poste (Multiposte) -->
    <div id="modal-poste" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden animate-fadeIn max-h-[90vh] overflow-y-auto">
            <div class="p-4 md:p-6 border-b flex justify-between items-center bg-white sticky top-0">
                <h3 id="poste-modal-title" class="text-lg font-bold text-slate-800">Nouveau poste</h3>
                <button onclick="closeModal('modal-poste')" class="p-2 hover:bg-slate-100 rounded-full"><i data-lucide="x"></i></button>
            </div>
            <form id="form-poste" onsubmit="savePoste(event)" class="p-4 md:p-6 space-y-4 bg-white">
                <input type="hidden" id="poste-edit-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nom du poste *</label>
                        <input type="text" id="poste-name" required placeholder="Ex: Caisse 1" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Mot de passe *</label>
                        <input type="password" id="poste-password" placeholder="Min. 4 caractères" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-amber-500">
                        <p id="poste-pwd-hint" class="text-xs text-slate-400 mt-1 hidden">Laisser vide pour ne pas changer</p>
                    </div>
                </div>
                <div class="border-t pt-4 mt-4">
                    <h5 class="font-semibold text-slate-700 mb-3">Accès aux sections</h5>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="dashboard"> Tableau de bord</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="stock"> Stock</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="sales"> Ventes</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="credits"> Crédits</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="expenses"> Dépenses</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="logs"> Journal</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="reports"> Rapports</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="settings"> Paramètres</label>
                    </div>
                </div>
                <div class="border-t pt-4">
                    <h5 class="font-semibold text-slate-700 mb-3">Actions autorisées</h5>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="stockAdd"> Stock: Ajouter</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="stockEdit"> Stock: Modifier</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="stockDelete"> Stock: Supprimer</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="stockAdjust"> Stock: Ajuster</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="salesCreate"> Ventes: Créer</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="salesCancel"> Ventes: Annuler</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="creditsPay"> Crédits: Régler</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="creditsDelete"> Crédits: Supprimer</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="expensesAdd"> Dépenses: Ajouter</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="expensesEdit"> Dépenses: Modifier</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="expensesDelete"> Dépenses: Supprimer</label>
                    </div>
                </div>
                <div class="border-t pt-4">
                    <h5 class="font-semibold text-slate-700 mb-3">Configuration (admin)</h5>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="configCompany"> Entreprise</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="configSecurity"> Sécurité</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="configData"> Données</label>
                        <label class="flex items-center gap-2 p-2 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="checkbox" class="poste-perm" data-perm="configPostes"> Gestion postes</label>
                    </div>
                </div>
                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeModal('modal-poste')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-slate-500 hover:bg-slate-50">Annuler</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-amber-600 text-white rounded-xl font-bold hover:bg-amber-700">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ajustement Stock -->
    <div id="modal-stock-adjust" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-md rounded-2xl md:rounded-3xl shadow-2xl overflow-hidden animate-fadeIn max-h-[90vh] overflow-y-auto">
            <div class="p-4 md:p-6 border-b flex justify-between items-center bg-white sticky top-0">
                <h3 class="text-lg md:text-xl font-bold text-slate-800">Ajustement Stock</h3>
                <button onclick="closeModal('modal-stock-adjust')" class="p-2 hover:bg-slate-100 rounded-full touch-target"><i data-lucide="x"></i></button>
            </div>
            <form id="form-stock-adjust" class="p-4 md:p-6 space-y-4 bg-white">
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Produit</label>
                    <select id="adjust-product" required class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                        <option value="">-- Sélectionner --</option>
                        <!-- JS Injection -->
                    </select>
                </div>
                <div id="product-cost-info" class="hidden p-3 bg-blue-50 rounded-lg">
                    <div class="text-sm">
                        <div class="flex justify-between">
                            <span class="text-slate-600">Prix d'achat :</span>
                            <span id="product-cost" class="font-bold">0 Ar</span>
                        </div>
                        <div class="flex justify-between mt-1">
                            <span class="text-slate-600">Coût total :</span>
                            <span id="total-cost" class="font-bold text-blue-600">0 Ar</span>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Type</label>
                    <div class="grid grid-cols-2 gap-2">
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:bg-blue-50">
                            <input type="radio" name="adjust-type" value="add" checked class="mr-2">
                            <div>
                                <div class="font-medium text-sm">Ajouter</div>
                                <div class="text-xs text-slate-500">Réapprovisionnement</div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:bg-amber-50">
                            <input type="radio" name="adjust-type" value="remove" class="mr-2">
                            <div>
                                <div class="font-medium text-sm">Retirer</div>
                                <div class="text-xs text-slate-500">Perte, casse</div>
                            </div>
                        </label>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Quantité</label>
                    <input type="number" id="adjust-qty" required min="1" class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Raison</label>
                    <textarea id="adjust-reason" rows="2" placeholder="Ex: Réapprovisionnement..." class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base"></textarea>
                </div>
                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeModal('modal-stock-adjust')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-slate-500 hover:bg-slate-50 touch-target">Annuler</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 touch-target">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Dépense -->
    <div id="modal-expense" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-md rounded-2xl md:rounded-3xl shadow-2xl overflow-hidden animate-fadeIn max-h-[90vh] overflow-y-auto">
            <div class="p-4 md:p-6 border-b flex justify-between items-center bg-white sticky top-0">
                <h3 id="expense-modal-title" class="text-lg md:text-xl font-bold text-slate-800">Nouvelle Dépense</h3>
                <button onclick="closeModal('modal-expense'); resetExpenseForm();" class="p-2 hover:bg-slate-100 rounded-full touch-target"><i data-lucide="x"></i></button>
            </div>
            <form id="form-expense-modal" class="p-4 md:p-6 space-y-4 bg-white">
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Catégorie</label>
                    <select id="expense-modal-category" required class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-amber-500 text-sm md:text-base">
                        <option value="">Sélectionner</option>
                        <option value="transports">Transports</option>
                        <option value="communication">Communication</option>
                        <option value="energie">Énergie</option>
                        <option value="achats_restaurant">Achats Restaurant</option>
                        <option value="achats_evenements">Achats Événements</option>
                        <option value="cotisations_sociales">Cotisations Sociales</option>
                        <option value="entretien">Entretien</option>
                        <option value="dejeuner_personnel">Déjeuner Personnel</option>
                        <option value="salaires_fixes">Salaires Fixes</option>
                        <option value="salaires_extra">Salaires Extra</option>
                        <option value="bonus_prime">Bonus et Prime</option>
                        <option value="divers_autres">Divers et Autres</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Motif</label>
                    <input type="text" id="expense-modal-motif" required placeholder="Ex: Loyer..." 
                        class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-amber-500 text-sm md:text-base">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Montant (Ar)</label>
                    <input type="number" id="expense-modal-amount" required placeholder="0" min="1"
                        class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-amber-500 text-sm md:text-base">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Date</label>
                    <input type="date" id="expense-modal-date" required
                        class="w-full px-3 md:px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-amber-500 text-sm md:text-base">
                </div>
                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeModal('modal-expense'); resetExpenseForm();" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-slate-500 hover:bg-slate-50 touch-target">Annuler</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-amber-600 text-white rounded-xl font-bold hover:bg-amber-700 touch-target">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Authentification -->
    <div id="modal-auth" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[110] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl md:rounded-3xl shadow-2xl p-6 md:p-8 text-center animate-fadeIn">
            <div class="w-16 h-16 md:w-20 md:h-20 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6">
                <i data-lucide="lock" class="w-8 h-8 md:w-10 md:h-10"></i>
            </div>
            <h3 class="text-lg md:text-xl font-bold text-slate-800 mb-2">Authentification</h3>
            <p id="auth-message" class="text-slate-500 text-sm mb-4 md:mb-6">Action nécessite authentification</p>
            <input type="password" id="auth-password" placeholder="Mot de passe" 
                class="w-full px-4 py-3 rounded-xl border mb-4 text-center outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
            <div id="auth-error" class="hidden text-red-500 text-sm mb-2"></div>
            <div class="flex gap-3">
                <button onclick="closeModal('modal-auth'); window.authCallback = null;" class="flex-1 px-4 py-3 font-bold text-slate-400 touch-target">Annuler</button>
                <button onclick="executeAuth()" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold touch-target">Valider</button>
            </div>
        </div>
    </div>

    <!-- Modal Reset Confirmation -->
    <div id="modal-reset" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[110] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl md:rounded-3xl shadow-2xl p-6 md:p-8 text-center animate-fadeIn">
            <div class="w-16 h-16 md:w-20 md:h-20 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6">
                <i data-lucide="trash-2" class="w-8 h-8 md:w-10 md:h-10"></i>
            </div>
            <h3 class="text-lg md:text-xl font-bold text-slate-800 mb-2">Réinitialisation</h3>
            <p class="text-slate-500 text-sm mb-4">Toutes les données seront supprimées.</p>
            <div class="text-xs text-slate-400 mb-2">Code administrateur</div>
            <input type="password" id="reset-pwd" placeholder="Code Admin" class="w-full px-4 py-3 rounded-xl border mb-4 text-center outline-none focus:ring-2 focus:ring-red-500 text-sm md:text-base">
            <div id="reset-error" class="hidden text-red-500 text-sm mb-2"></div>
            <div class="flex gap-3">
                <button onclick="closeModal('modal-reset')" class="flex-1 px-4 py-3 font-bold text-slate-400 touch-target">Annuler</button>
                <button onclick="confirmReset()" class="flex-1 px-4 py-3 bg-red-600 text-white rounded-xl font-bold touch-target">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmation Générique -->
    <div id="modal-confirm" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[105] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl md:rounded-3xl shadow-2xl p-6 text-center animate-fadeIn">
            <div id="confirm-icon" class="w-12 h-12 md:w-16 md:h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="alert-circle" class="w-6 h-6 md:w-8 md:h-8"></i>
            </div>
            <h3 id="confirm-title" class="text-base md:text-lg font-bold text-slate-800 mb-2">Confirmation</h3>
            <p id="confirm-message" class="text-slate-600 text-sm mb-6"></p>
            <div class="flex gap-3">
                <button onclick="closeModal('modal-confirm'); window.confirmCallback = null;" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-slate-500 hover:bg-slate-50 touch-target">Annuler</button>
                <button onclick="executeConfirm()" id="confirm-action" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold touch-target">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Modal Facture -->
    <div id="modal-invoice" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[120] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-4xl rounded-2xl md:rounded-3xl shadow-2xl overflow-hidden animate-fadeIn flex flex-col max-h-[80vh]">
            <div class="p-4 md:p-6 border-b flex justify-between items-center sticky top-0 bg-white">
                <h3 class="text-lg md:text-xl font-bold text-slate-800">Facture</h3>
                <div class="flex gap-2">
                    <button onclick="printInvoice()" class="px-3 md:px-4 py-2 border border-slate-200 rounded-lg font-medium text-slate-600 hover:bg-slate-50 flex items-center gap-2 touch-target">
                        <i data-lucide="printer" class="w-4 h-4"></i> <span class="hidden md:inline">Imprimer</span>
                    </button>
                    <button onclick="closeModal('modal-invoice')" class="p-2 hover:bg-slate-100 rounded-full touch-target"><i data-lucide="x"></i></button>
                </div>
            </div>
            <div class="p-4 md:p-8 overflow-auto">
                <div id="invoice-content" class="invoice-preview p-4 md:p-8 rounded-xl text-sm md:text-base">
                    <!-- Invoice content will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div id="toast" class="fixed top-4 md:top-6 left-1/2 -translate-x-1/2 z-[200] px-4 md:px-6 py-2 md:py-3 bg-slate-900 text-white rounded-full shadow-2xl flex items-center gap-2 md:gap-3 transform translate-y-[-100px] transition-transform duration-300 pointer-events-none max-w-[90%]">
        <div id="toast-icon"></div>
        <span id="toast-message" class="text-xs md:text-sm font-medium truncate">Message</span>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loading-overlay" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[300] hidden flex items-center justify-center">
        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl flex flex-col items-center gap-3 md:gap-4">
            <div class="loader"></div>
            <div class="text-sm font-medium text-slate-700">Chargement...</div>
        </div>
    </div>
</div>
    <!-- SCRIPT SECTION -->
    <script src="app.js"></script>
</body>
</html>
